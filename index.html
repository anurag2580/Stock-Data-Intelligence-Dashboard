<!DOCTYPE html>
<html>
<head>
    <title>Stock Dashboard</title>
    <style>
        body { font-family: sans-serif; display: flex; height: 100vh; margin: 0; }
        .sidebar { width: 200px; background: #f4f4f4; padding: 20px; }
        .main { flex: 1; padding: 20px; }
        .card { background: #fff; padding: 15px; border: 1px solid #ddd; display: inline-block; width: 150px; margin-right: 10px; border-radius: 8px;}
        .chart-box { margin-top: 20px; border: 1px solid #ddd; padding: 10px; border-radius: 8px;}
        li { cursor: pointer; padding: 5px; color: blue; }
        li:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h3>Stocks</h3>
        <ul id="list"></ul>
    </div>

    <div class="main">
        <h1 id="title">Select a Stock</h1>
        
        <div class="card">
            <small>Price</small>
            <h2 id="price">-</h2>
        </div>
        <div class="card">
            <small>Volatility</small>
            <h2 id="volatility">-</h2>
        </div>
        <div class="card" style="border-color: blue;">
            <small>AI Prediction</small>
            <h2 id="ai">-</h2>
        </div>

        <div class="chart-box">
            <img id="chartImg" src="" style="width: 100%; height: 400px; object-fit: contain;">
        </div>
    </div>

    <script>
        const API = "http://127.0.0.1:8000";

        async function load() {
            const res = await fetch(API + "/companies");
            const companies = await res.json();
            const list = document.getElementById("list");
            
            companies.forEach(c => {
                const li = document.createElement("li");
                li.innerText = c.symbol;
                li.onclick = () => show(c.symbol);
                list.appendChild(li);
            });
        }

        async function show(symbol) {
            document.getElementById("title").innerText = symbol;
            
            // 1. Get Summary
            const res = await fetch(`${API}/summary/${symbol}`);
            const data = await res.json();
            document.getElementById("price").innerText = "₹" + data.current_price;
            document.getElementById("volatility").innerText = data.volatility;

            // 2. Get AI Prediction
            const aiRes = await fetch(`${API}/predict/${symbol}`);
            const aiData = await aiRes.json();
            document.getElementById("ai").innerText = "₹" + aiData.prediction;

            // 3. Load Matplotlib Image directly
            document.getElementById("chartImg").src = `${API}/chart/${symbol}?t=${Date.now()}`;
        }

        load();
    </script>
</body>
</html>